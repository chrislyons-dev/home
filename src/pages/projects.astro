---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import projectsMermaidUrl from '../scripts/projects-mermaid.js?url';

const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) => a.data.order - b.data.order);
---

<Layout
  title="Projects - Chris Lyons"
  description="A showcase of development projects, architectural solutions, and open source contributions."
>
  <div class="section-container">
    <h1 class="page-title mb-4">Projects</h1>
    <p class="text-muted mb-12 text-xl">Selected work. Real problems, real solutions.</p>

    <div class="space-y-8">
      {
        sortedProjects.map(async (project) => {
          const { Content } = await project.render();
          return (
            <article
              class="rounded-lg border p-6 transition-all hover:shadow-lg"
              style={`border-color: ${
                project.data.featured
                  ? 'color-mix(in oklch, var(--theme-accent-strong) 30%, transparent)'
                  : 'var(--theme-border-default)'
              }; background: ${
                project.data.featured
                  ? 'linear-gradient(to bottom right, var(--theme-bg-surface), var(--theme-bg-base))'
                  : 'var(--theme-bg-surface)'
              };`}
            >
              <div class="mb-3 flex items-start justify-between">
                <h2 class="text-2xl font-bold">{project.data.title}</h2>
                {project.data.featured && <span class="badge-accent">Featured</span>}
              </div>
              <p class="text-body mb-4">{project.data.description}</p>
              <div class="mb-4 flex flex-wrap gap-2">
                {project.data.tech.map((tech) => (
                  <span
                    class="rounded-md px-3 py-1 text-sm"
                    style="background: var(--theme-bg-elevated); color: var(--theme-text-secondary);"
                  >
                    {tech}
                  </span>
                ))}
              </div>
              {project.body && (
                <div
                  class="prose prose-sm dark:prose-invert mt-4 max-w-none border-t pt-4"
                  style="border-color: var(--theme-border-default);"
                >
                  <Content />
                </div>
              )}
            </article>
          );
        })
      }
    </div>

    <div
      class="mt-16 rounded-lg border p-8 text-center"
      style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
    >
      <h2 class="mb-4 text-2xl font-bold">Want to See More?</h2>
      <p class="text-muted mb-6">These are just highlights. I'm always working on something new.</p>
      <a href="/contact" class="btn-primary inline-block">Get in Touch</a>
    </div>
    <script type="module" src={projectsMermaidUrl}></script>
  </div>
</Layout>
