---
import Layout from '../layouts/Layout.astro';
---

<Layout
  title="Architecture  -  Chris Lyons"
  description="Architecture as code examples using Mermaid and PlantUML diagrams that live with the system."
>
  <div class="mx-auto max-w-6xl px-4 py-20 sm:px-6 lg:px-8">
    <h1 class="mb-4 text-4xl font-bold sm:text-5xl">Architecture as Code</h1>
    <p class="text-muted mb-12 text-xl">
      C4 diagrams generated from source code, updated on every commit. PlantUML and Mermaid rendered
      in CI/CD and deployed to GitHub Pages.
    </p>

    <!-- Architecture Philosophy -->
    <div class="info-box-featured mb-16">
      <h2 class="mb-4 text-2xl font-bold">Why Architecture as Code?</h2>
      <p class="text-body mb-4">
        Diagrams live in your codebase, version-controlled and auto-generated. They evolve with your
        system instead of rotting in outdated PowerPoints.
      </p>
      <ul class="text-body space-y-2">
        <li>
          - <strong>Updated on every commit</strong> - <code
            class="rounded px-2 py-1 text-sm"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >npm run docs:arch</code
          > regenerates C4 diagrams from source
        </li>
        <li>
          - <strong>Version controlled</strong> - Track architecture changes in Git, see diffs in PRs
        </li>
        <li>
          - <strong>Reviewed like code</strong> - Architecture changes go through pull requests with team
          visibility
        </li>
        <li>
          - <strong>Published in CI/CD</strong> - Diagrams render and deploy automatically (this site
          uses GitHub Actions)
        </li>
      </ul>
    </div>

    <!-- C4 Model Levels -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">C4 Model: 4 Levels of Architecture Diagrams</h2>
      <p class="text-muted mb-6">
        Progressive zoom from system context down to code level. Each level can be automatically
        generated from your infrastructure and application code.
      </p>

      <div class="grid gap-6 md:grid-cols-2">
        <!-- Level 1: System Context -->
        <div
          class="rounded-lg border-2 p-6"
          style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
        >
          <div class="mb-4 flex items-center justify-between">
            <h3 class="text-xl font-bold">Level 1: System Context</h3>
            <span class="badge-accent">System</span>
          </div>
          <p class="text-muted mb-4 text-sm">
            Big picture: your system, users, and external dependencies
          </p>
          <div
            class="mb-4 rounded p-3 font-mono text-xs"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
          >
            User -&gt; Web App -&gt; Database<br />
            Web App -&gt; Payment API<br />
            Web App -&gt; Email Service
          </div>
          <div class="space-y-2 text-sm">
            <div>
              <strong class="text-accent">How It Works:</strong>
              <p class="text-muted mt-1">
                Parse deployment pipelines and infrastructure configs to extract external systems
              </p>
            </div>
            <div class="border-l-2 pl-4" style="border-color: var(--theme-border-emphasis);">
              <strong class="text-accent text-xs">Real Example:</strong>
              <p class="text-muted mt-1 text-xs">
                Parse <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >.github/workflows/cd.yml</code
                > to extract Cloudflare Pages, deployment triggers, and external services
              </p>
            </div>
          </div>
        </div>

        <!-- Level 2: Container -->
        <div
          class="rounded-lg border-2 p-6"
          style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
        >
          <div class="mb-4 flex items-center justify-between">
            <h3 class="text-xl font-bold">Level 2: Container</h3>
            <span class="badge-secondary text-xs font-semibold">Container</span>
          </div>
          <p class="text-muted mb-4 text-sm">
            Applications, databases, microservices, file systems
          </p>
          <div
            class="mb-4 rounded p-3 font-mono text-xs"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
          >
            React SPA<br />
            Node.js API<br />
            Redis Cache<br />
            PostgreSQL DB
          </div>
          <div class="space-y-2 text-sm">
            <div>
              <strong class="text-accent">How It Works:</strong>
              <p class="text-muted mt-1">
                Parse Infrastructure as Code to extract resources and dependencies
              </p>
            </div>
            <div class="border-l-2 pl-4" style="border-color: var(--theme-border-emphasis);">
              <strong class="text-muted text-xs">Real Example:</strong>
              <p class="text-muted mt-1 text-xs">
                <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >inframap generate terraform/</code
                > generates PlantUML from Terraform state, or parse <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >package.json</code
                > dependencies
              </p>
            </div>
          </div>
        </div>

        <!-- Level 3: Component -->
        <div
          class="rounded-lg border-2 p-6"
          style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
        >
          <div class="mb-4 flex items-center justify-between">
            <h3 class="text-xl font-bold">Level 3: Component</h3>
            <span class="badge-secondary text-xs font-semibold">Component</span>
          </div>
          <p class="text-muted mb-4 text-sm">
            Services, controllers, repositories within a container
          </p>
          <div
            class="mb-4 rounded p-3 font-mono text-xs"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
          >
            UserService<br />
            OrderController<br />
            PaymentGateway<br />
            DatabaseRepository
          </div>
          <div class="space-y-2 text-sm">
            <div>
              <strong class="text-accent">How It Works:</strong>
              <p class="text-muted mt-1">
                Scan source code directory structure and module organization
              </p>
            </div>
            <div class="border-l-2 pl-4" style="border-color: var(--theme-border-emphasis);">
              <strong class="text-accent text-xs">Real Example:</strong>
              <p class="text-muted mt-1 text-xs">
                Recursively scan <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >src/services/</code
                >, <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >src/components/</code
                > directories and parse <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >index.ts</code
                > exports
              </p>
            </div>
          </div>
        </div>

        <!-- Level 4: Code -->
        <div
          class="rounded-lg border-2 p-6"
          style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
        >
          <div class="mb-4 flex items-center justify-between">
            <h3 class="text-xl font-bold">Level 4: Code</h3>
            <span class="badge-secondary text-xs font-semibold">Code</span>
          </div>
          <p class="text-muted mb-4 text-sm">Classes, methods, functions, interfaces</p>
          <div
            class="mb-4 rounded p-3 font-mono text-xs"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
          >
            class UserService {'{'}<br />
            &nbsp;&nbsp;getUser(id)<br />
            &nbsp;&nbsp;updateUser(id, data)<br />
            &nbsp;&nbsp;deleteUser(id)<br />
            {'}'}
          </div>
          <div class="space-y-2 text-sm">
            <div>
              <strong class="text-accent">How It Works:</strong>
              <p class="text-muted mt-1">
                Use AST parsers to extract class structures, method signatures, and dependencies
              </p>
            </div>
            <div class="border-l-2 pl-4" style="border-color: var(--theme-border-emphasis);">
              <strong class="text-accent text-xs">Real Example:</strong>
              <p class="text-muted mt-1 text-xs">
                Use <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >acorn</code
                > or <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >@babel/parser</code
                > to parse TypeScript files and extract class methods, or use <code
                  class="rounded px-1"
                  style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
                  >typedoc</code
                > for full API docs
              </p>
            </div>
          </div>
        </div>
      </div>

      <div
        class="mt-6 rounded border p-4"
        style="border-color: var(--theme-badge-accent-ring); background: var(--theme-badge-accent-bg);"
      >
        <p class="text-body text-sm">
          <strong>This Portfolio:</strong> All 4 C4 levels are auto-generated from code using
          <code
            class="rounded px-2 py-1 text-xs"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >npm run docs:arch</code
          >
        </p>
      </div>
    </section>

    <!-- Example 1: C4 Level 1 - System Context -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">
        <span class="badge-accent mr-2 text-sm font-semibold">Level 1</span>
        System Context Example
      </h2>
      <p class="text-muted mb-6">
        High-level view of this portfolio site and its external dependencies, auto-generated from
        GitHub Actions workflows.
      </p>

      <div
        class="rounded-lg border p-6"
        style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
      >
        <div class="mb-4">
          <img
            src="/architecture/portfolio-system-context.svg"
            alt="Portfolio System Context Diagram"
            class="mx-auto block h-auto max-w-full rounded p-4"
            style="width: auto;"
          />
        </div>
        <div class="text-muted text-sm">
          <strong>Generated from:</strong>
          <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >.github/workflows/cd.yml</code
          > and <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >ci.yml</code
          >
        </div>
      </div>
    </section>

    <!-- Example 2: C4 Level 2 - Microservices -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">
        <span class="badge-secondary mr-2 text-sm font-semibold">Level 2</span>
        Container Example: Microservices Architecture
      </h2>
      <p class="text-muted mb-6">
        Event-driven microservices with Kafka showing containers (services, databases, message
        queues) and their interactions.
      </p>

      <div
        class="rounded-lg border p-6"
        style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
      >
        <div class="mb-4">
          <img
            src="/architecture/microservices.svg"
            alt="Microservices Container Diagram"
            class="mx-auto block h-auto max-w-full rounded p-4"
            style="width: auto;"
          />
        </div>
        <div class="text-muted text-sm">
          <strong>Source:</strong>
          <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >docs/architecture/examples/microservices.mmd</code
          >
        </div>
      </div>
    </section>

    <!-- Example 3: C4 Level 2 - Data Pipeline -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">
        <span class="badge-secondary mr-2 text-sm font-semibold">Level 2</span>
        Container Example: Data Pipeline Architecture
      </h2>
      <p class="text-muted mb-6">
        Real-time and batch data processing containers showing data flow from ingestion through
        transformation to consumption.
      </p>

      <div
        class="rounded-lg border p-6"
        style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
      >
        <div class="mb-4">
          <img
            src="/architecture/data-pipeline.svg"
            alt="Data Pipeline Container Diagram"
            class="mx-auto block h-auto max-w-full rounded p-4"
            style="width: auto;"
          />
        </div>
        <div class="text-muted text-sm">
          <strong>Source:</strong>
          <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >docs/architecture/examples/data-pipeline.mmd</code
          >
        </div>
      </div>
    </section>

    <!-- Example 4: C4 Level 3 - Components -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">
        <span class="badge-secondary mr-2 text-sm font-semibold">Level 3</span>
        Component Example: Order Service
      </h2>
      <p class="text-muted mb-6">
        Zooming into the Order Service container to show its internal components, controllers, and
        repositories.
      </p>

      <div
        class="rounded-lg border p-6"
        style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
      >
        <img
          src="/architecture/order-service.svg"
          alt="C4 Component Diagram - Order Service"
          class="mx-auto block h-auto max-w-full rounded p-4"
          style="width: auto;"
        />
        <div class="text-muted mt-4 text-sm">
          <strong>Source:</strong>
          <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >docs/architecture/examples/order-service.puml</code
          >
        </div>
      </div>
    </section>

    <!-- Example 5: C4 Level 4 - Code -->
    <section class="mb-16">
      <h2 class="mb-6 text-3xl font-bold">
        <span class="badge-secondary mr-2 text-sm font-semibold">Level 4</span>
        Code Example: ThemeManager Class
      </h2>
      <p class="text-muted mb-6">
        Zooming into a component to show class structure and method signatures, auto-generated from
        TypeScript source code.
        <strong>Note:</strong> Level 4 diagrams are optional. They're great for critical algorithms, security
        components, or complex business logic that needs detailed documentation. But avoid generating
        them for entire systems - they quickly become overwhelming and unmaintainable at scale.
      </p>

      <div
        class="rounded-lg border p-6"
        style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
      >
        <div class="mb-4">
          <img
            src="/architecture/theme-manager.svg"
            alt="ThemeManager Class Diagram"
            class="mx-auto block h-auto max-w-full rounded p-4"
            style="width: auto;"
          />
        </div>
        <div class="text-muted text-sm">
          <strong>Generated from:</strong>
          <code
            class="rounded px-2 py-1"
            style="background: var(--theme-bg-elevated); color: var(--theme-text-primary);"
            >src/services/ThemeManager.ts</code
          > using AST parsing
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <div
      class="rounded-lg border p-8 text-center"
      style="border-color: var(--theme-border-default); background: var(--theme-bg-surface);"
    >
      <h2 class="mb-4 text-2xl font-bold">Want This for Your Systems?</h2>
      <p class="text-muted mb-6">
        Architecture that lives with code. Documentation that evolves with your team.
      </p>
      <a href="/contact" class="btn-primary inline-block">Let's Talk</a>
    </div>
  </div>
</Layout>
